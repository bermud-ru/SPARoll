
 /**
 * @app jsroll.min.js
 * @category RIA (Rich Internet Application) / SPA (Single-page Application)
 *
 * Классы RIA / SPA javascritp framework
 * @author Андрей Новиков <andrey@novikov.be>
 * @status beta
 * @version 0.1.0
 * @revision $Id: jsroll.min.js 0004 29/01/2017 13:15:19Z $
 */

(function(g,undefined){"use strict";var version="1.0.1b";var xmlHttpRequest=("onload" in new XMLHttpRequest())?XMLHttpRequest:XDomainRequest;var uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:(r&3|8);return v.toString(16)})};g.uuid=uuid;var params=function(search){var re=/[?&]([^=#]+)=([^&#]*)/g,p={},m;try{while(m=re.exec((search||g.location.search))){if(m[1]&&m[2]){p[decodeURIComponent(m[1])]=decodeURIComponent(m[2])}}}catch(e){return null}return p};g.location.params=params;var update=function(search,params){var u=[],h=[],url=g.location.search,kv=params||{};if(typeof search==="string"){url=search}else{kv=search}var p=g.location.params(url);if(url.indexOf("#")>-1){h=url.split("#")}if(url.indexOf("?")>-1){u=url.split("?")}for(var i in kv){p[decodeURIComponent(i)]=decodeURIComponent(kv[i])}var res=[];for(var a in p){res.push(a+"="+p[a])}if(res.length){if(!u.length&&!h.length){return url+"?"+res.join("&")}else{if(u.length&&!h.length){return u[0]+"?"+res.join("&")}else{if(u.length&&h.length){return u[0]+"?"+res.join("&")+h[1]}else{if(!u.length&&h.length){return h[0]+"?"+res.join("&")+h[1]}}}}}return url};g.location.update=update;g.fadeRule=[0,0.301,0.477,0.602,0.699,0.778,0.845,0.903,0.954,1];function fadeOut(el,cb){var st=null,d=8,fn=function fn(d,cb){this.style.opacity=g.fadeRule[d];if(d--<=0){if(typeof cb==="function"){cb.call(this)}this.style.display="none";clearTimeout(st)}else{st=setTimeout(fn.bind(this,d,cb),typeof cb==="number"?cb:25)}};if(el){el.style.display="inherit";el.style.opacity=1;st=setTimeout(fn.bind(el,d,cb),typeof cb==="number"?cb:25)}}g.fadeOut=fadeOut;function fadeIn(el,cb){var st=null,d=1,fn=function fn(d,cb){this.style.opacity=g.fadeRule[d];if(d++>=9){if(typeof cb==="function"){cb.call(this)}clearTimeout(st)}else{st=setTimeout(fn.bind(this,d,cb),typeof cb==="number"?cb:25)}};if(el){el.style.display="inherit";el.style.opacity=0;st=setTimeout(fn.bind(el,d,cb),typeof cb==="number"?cb:25)}}g.fadeIn=fadeIn;function router(r){var isHistory=!!(history.pushState)?1:0;var root=r;return{root:root,rt:[],itv:0,base:isHistory?g.location.pathname+g.location.search:"",referrer:root,clr:function(path){return path.toString().replace(/\/$/,"").replace(/^\//,"")},fr:isHistory?function(){return this.root+this.clr(decodeURI(g.location.pathname+g.location.search)).replace(/\?(.*)$/,"")}:function(){var m=g.location.href.match(/#(.*)$/);return this.root+(m?this.clr(m[1]):"")},add:function(re,handler){if(typeof re=="function"){handler=re;re=""}this.rt.push({re:re,handler:handler});this.rt=this.rt.sort(function(a,b){if(a.re.toString().length<b.re.toString().length){return 1}if(a.re.toString().length>b.re.toString().length){return -1}return 0});return this},rm:function(param){for(var i in this.rt){if(this.rt[i].handler===param||this.rt[i].re.toString()===param.toString()){this.rt.splice(i,1);return this}}return this},chk:function(fr){var f=fr||this.fr(),m=false;for(var i in this.rt){if(m=f.match(this.rt[i].re)){this.rt[i].handler.call(m||{},f);return this}}return this},lsn:function(){var s=this,c=s.fr(),fn=function(){if(c!==s.fr()){c=s.fr();s.chk(c)}return s};clearInterval(s.itv);s.itv=setInterval(fn,50);return s},set:isHistory?function(path){this.referrer=g.location.pathname+g.location.search;history.pushState(null,null,this.root+this.clr(path||""));return this}:function(path){this.referrer=g.location.pathname+g.location.search;window.location.href=g.location.href.replace(/#(.*)$/,"")+"#"+(path||"");return this}}}g.router=router("/");function chain(){var c={tuple:[],cache:[],donned:function(fn){return false},failed:function(fn){return false},pool:function(fn,arg){this.chain.cache.push(this);if(this.chain.tuple.length==this.chain.cache.length){this.chain.donned.apply(this.chain,this.chain.cache)}},done:function(fn){this.donned=fn},fail:function(fn){this.failed=fn}};c.tuple=Array.prototype.slice.call(arguments).map(function(fn){fn.onload=function(){c.pool.apply(fn,arguments)};fn.chain=c;return fn});return c}g.chain=chain;function xhr(params){var x=new xmlHttpRequest();if(!x){return null}x.fail=function(fn){if(typeof x.after=="function"){x.after.call(x)}if(typeof fn==="function"){return fn.call(x,e)}return this};x.done=function(fn){if(typeof fn==="function"){return fn.call(this)}return this};x.process=function(fn){x.onreadystatechange=function(e){if(typeof fn==="function"){return fn.call(this,e)}};return this};x.onload=function(e){if(typeof x.after=="function"){x.after.call(x)}return x.done.call(x,e)};var opt=Object.assign({method:"GET"},params);var rs=Object.assign({"Xhr-Version":version,"Content-type":"application/x-www-form-urlencoded"},params.rs);var id=opt.method+"_"+(opt.url?opt.url.replace(/(\.|:|\/|\-)/g,"_"):g.uuid());try{for(var i in opt){if(typeof opt[i]=="function"){x[i]=opt[i]}}if((["GET","DELETE"].indexOf(opt.method.toUpperCase())>=0)&&opt.data){opt.url=(opt.url||g.location)+"?"+opt.data;opt.data=null}if(typeof x.before=="function"){x.before.call(x,opt)}x.open(opt.method,opt.url||g.location,opt.async||true,opt.username,opt.password);for(var m in rs){x.setRequestHeader(m.trim(),rs[m].trim())}x.send(opt.data||null);x.id=id}catch(e){x.abort();x.fail.call(x,e)}return g.xhr.ref[id]=x}xhr.ref={};g.xhr=xhr;function form(f){f.setAttribute("valid",1);f.response=null;f.method=f.method||"GET";f.validator=f.validator||null;f.opt=f.opt||{};f.done=f.done||null;f.prepare=function(validator){var data=[];if(!validator||(typeof validator==="function"&&validator.call(f,data))){for(var i=0;i<f.elements.length;i++){data.push((f.elements[i].name||i)+"="+(["checkbox","radio"].indexOf((f.elements[i].getAttribute("type")||"text").toLowerCase())<0?encodeURIComponent(f.elements[i].value):(f.elements[i].checked?1:0)))}}else{f.setAttribute("valid",0)}return data.join("&")};f.update=function(data){for(var i=0;i<f.elements.length;i++){if(data[f.elements[i].name]){f.elements[i].value=data[f.elements[i].name]}else{var field=/\[([^\]]+)\]/.exec(f.elements[i].name)[1];if(field&&data[field]){f.elements[i].value=data[field]}}}return f};f.fail=typeof f.fail=="function"?f.fail:function(res){if(res.form){for(var i=0;i<this.elements.length;i++){if(res.form.hasOwnProperty(this.elements[i].name)){g.css.el(this.elements[i].parentElement).add("has-error")}else{g.css.el(this.elements[i].parentElement).del("has-error")}return true}}return false};f.send=function(callback){var data=f.prepare(f.validator);if(f.getAttribute("valid")!=0){if(typeof f.before=="function"){f.before.call(this)}g.xhr(Object.assign({method:f.method,url:f.action,data:data,done:typeof callback=="function"?function(){if(typeof f.after=="function"){f.after.call(this)}return callback.apply(this,arguments)}:function(arg){if(typeof f.after=="function"){f.after.call(this,arg)}var res={result:"error"};f.response=this.responseText;if([200,206].indexOf(this.status)<0){res.message=this.status+": "+this.statusText}else{try{res=JSON.parse(this.responseText)}catch(e){res.message="Cервер вернул не коректные данные"}}if(res.result=="error"){if(typeof f.fail=="function"){f.fail.call(f,res)}}else{if(res.result=="ok"){if(typeof f.done=="function"){f.done.call(f,res)}}}return f}},f.opt))}return f};return f}g.JSON.form=form;var tmpl=function tmpl(str,data,cb,opt){g.arguments=arguments;var compile=function(str){var source=str.replace(/(\/\*[\w\'\s\r\n\*]*\*\/)|(\/\/[\w\s\']*)|(\<![\-\-\s\w\>\/]*\>)/igm,"").replace(/\>\s+\</g,"><").trim();return source.length?new Function("_e","var p=[], print=function(){ p.push.apply(p,arguments); };with(_e){p.push('"+source.replace(/[\r\t\n]/g," ").split("{%").join("\t").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("\t").join("');").split("%}").join("p.push('").split("\r").join("\\'")+"');} return p.join('').replace(/<%/g,'{%').replace(/%>/g,'%}');"):undefined},build=function(str,id){var isId=typeof id!=="undefined",pattern=null;var result=null,after=undefined,before=undefined,args=undefined;var pig=g.document.getElementById(id);var data={};var context;try{if(pig){if(before=pig.getAttribute("before")){eval.call(g.arguments,before)}var nn=undefined;Array.prototype.slice.call(pig.attributes).map(function(i){if(i&&/^tmpl-*/i.test(i.nodeName.toString())&&(nn=i.nodeName.toString().replace(/^tmpl-/i,""))){try{data[nn]=JSON.parse(i.nodeValue)}catch(e){data[nn]=i.nodeValue}}});if(args=pig.getAttribute("arguments")){data=Object.assign(JSON.parse(args)||{},data,g.arguments[1])}}if(opt&&typeof opt.before=="object"){data=Object.assign(data,opt.before)}else{if(opt&&typeof opt.before=="function"){opt.before.call(this,data)}}data=Object.assign(data,g.arguments[1]||{});if(isId&&g.tmpl.cache[id]){pattern=g.tmpl.cache[id]}else{pattern=compile(str);if(isId){g.tmpl.cache[id]=pattern}}result=pattern.call(g.tmpl,data);if(typeof cb=="function"){context=cb.call(pattern||g.tmpl,result)||g.tmpl}else{if(typeof cb=="object"&&(context=cb)){context.innerHTML=result}}if(pig&&(after=pig.getAttribute("after"))){(function(){return eval(after)}).apply(context,g.arguments)}if(opt&&typeof opt.after=="function"){opt.after.apply(context,g.arguments)}}catch(e){console.error("#",id||str,"Error:",e);return undefined}return result};switch(true){case str.match(/^(?:https?:\/\/)?(?:(?:[\w]+\.)(?:\.?[\w]{2,})+)?([\/\w]+)(\.[\w]+)/i)?true:false:var id=str.replace(/(\.|\/|\-)/g,"");if(g.tmpl.cache[id]){return build(null,id)}return g.xhr(Object.assign({url:str,async:(typeof cb=="function"),done:function(e){if([200,206].indexOf(this.status)<0){console.warn(this.status+": "+this.statusText)}else{build(this.responseText,id)}}},opt));case !/[^\w\-\.]/.test(str):return build(g.document.getElementById(str).innerHTML,str);default:return build(str)}};tmpl.cache={};g.tmpl=tmpl;var storage=function(s){var s=s||g.localStorage;try{s.setItem("test","1");s.removeItem("test")}catch(e){return{p:[],setItem:function(key,value){this.p.push(key);this[key]=value},getItem:function(key){if(this.hasOwnProperty(key)){return this[key]}return null},removeItem:function(key){if(this.hasOwnProperty(key)){delete this.p[key];delete this[key]}},clear:function(){this.p.map(function(item){delete this[item]});this.p=[]}}}return s};g.storage=storage()}(window));(function(c,e){"use strict";c.config={app:{container:'[role="workspace"]'},msg:{container:".alert.alert-danger",tmpl:"alert-box"},spinner:".locker.spinner",popup:{wnd:".b-popup",container:".b-popup .b-popup-content"}};var d=function(f){this._parent=null;this._css=null;this.instance=f||c;return this};d.prototype={create:function(g,f){if(typeof g==="object"){var h=new d(g);if(h&&typeof f=="string"){c[f]=h}return h}return null},el:function(h,f){var g=null;if(typeof h==="string"){if(!h.match(/^#*/)){g=c.document.getElementById(h.replace(/^#/,""))}else{g=this.instance.querySelector(h)}}else{if(typeof h==="object"){g=h}}if(g){if(!g.hasOwnProperty("ui")){g.ui=new d(g)}if(typeof f==="string"){c[f]=g}else{if(typeof f==="function"){f.call(g,arguments)}}}return g},els:function(i,h,f){if(typeof i==="string"){var g=this.instance.querySelectorAll(i),j=0;if(!g){return[]}return Array.prototype.slice.call(g).map(function(k){if(!k.hasOwnProperty("ui")){k.ui=new d(k)}if(typeof h=="function"){h.call(c,k,j++)}if(typeof h=="string"||typeof f=="string"){if(!c[f]){c[f]=[]}c[f].push(k)}return k})}else{return[]}},attr:function(f,g){if(f&&typeof g==="undefined"){try{return JSON.parse(this.instance.getAttribute(f))}catch(h){return this.instance.getAttribute(f)}}else{if(f&&g){if(typeof g==="object"){this.instance.setAttribute(f,JSON.stringify(g))}else{this.instance.setAttribute(f,g)}}}return this},merge:function(){var g=1,f=arguments[0]||{};if(this.instance.hasOwnProperty("ui")){f=this.instance;g=0}Array.prototype.slice.call(arguments,g).forEach(function(j,i,h){Object.defineProperties(f,Object.keys(j).reduce(function(l,k){l[k]=Object.getOwnPropertyDescriptor(j,k);return l},{}))});return f},get parent(){return this._parent||(this._parent=new d(this.instance&&this.instance.parentElement))},src:function(g){var f=g?g:this.instance;return new d(f.srcElement||f.target)},get a(){return this._css||(this._css=new a(this.instance))},on:function(h,g,f){this.instance.addEventListener(h,g,!!f);return this.instance},xml:function(j,h){var f,g;if(!j||typeof j!=="string"){return null}try{if(c.DOMParser){g=new DOMParser();f=g.parseFromString(j,h||"text/xml")}else{f=new ActiveXObject("Microsoft.XMLDOM");f.async="false";f.loadXML(j)}}catch(i){f=e}return f},focus:function(g){var f;if(g){f=(typeof g=="string"?c.querySelector(g):g)}else{f=this.instance}if(f){c.setTimeout(function(){f.focus();return false},0)}return f}};c.ui=new d(document);var a=function(f){this.instance=f;return this};a.prototype={el:function(f){this.instance=typeof f==="string"?document.querySelector(f):f;return this},style:function(g,f){this.instance.style[g]=f;return this},re:function(f,h){return new RegExp(f,h||"g")},has:function(f){return this.instance.className.match(this.re("(?:^|\\s)"+f+"(?!\\S)"))},add:function(f){if(this.instance&&!this.has(f)){this.instance.className+=" "+f}return this},del:function(f){if(this.instance){this.instance.className=this.instance.className.replace(this.re("(?:^|\\s)"+f+"(?!\\S)"),"")}return this},tgl:function(f){if(this.instance){if(!this.has(f)){this.instance.className+=" "+f}else{this.instance.className=this.instance.className.replace(this.re("(?:^|\\s)"+f+"(?!\\S)"),"")}}return this}};c.css=new a(document);Object.defineProperty(c,"selected",{get:function b(){return c.getSelection?c.getSelection().toString():document.selection.createRange().text}})}(window));(function(c,d,h){if(typeof d==="undefined"){return false}var f={elem:d.el(c.config.msg.container),show:function(i,g){tmpl(c.config.msg.tmpl,i,this.elem);fadeIn(this.elem,0);if(typeof g=="undefined"||!g){fadeOut(this.elem,90)}return this.elem}};c.msg=f;c.spinner_count=0;c.spinner_element=d.el(c.config.spinner);if(c.spinner_element){Object.defineProperty(c,"spinner",{__proto__:null,enumerable:false,configurable:false,set:function(g){g?c.spinner_count++:c.spinner_count--;c.spinner_count>0?c.spinner_element.style.display="block":c.spinner_element.style.display="none"},get:function(){if(c.spinner_element.style.display=="none"){return false}return true}})}c.formvalidator=function(k){var l=function(m){if(m){var i=true;if((m.getAttribute("required")!==null)&&!m.value){i=false}else{if((m.getAttribute("required")===null)&&!m.value){i=true}else{if(m.getAttribute("pattern")===null){i=true}else{try{var p=/[?\/]([^\/]+)\/([^\/]*)/g.exec(m.getAttribute("pattern"))||[];var o=new RegExp(p[1],p[2]);i=o.test(m.value.trim())}catch(q){i=false}}}}var n=b(m.hasOwnProperty("ui")?m.ui:d.create(m));if(!i){n.instance.status="error"}else{if(!n.instance.hasAttribute("disabled")){if(m.value.length){n.instance.status="success"}else{n.instance.status=null}}}return i}return false};var g=true;for(var j=0;j<this.elements.length;j++){g=g&l(this.elements[j])}if(!g){spinner=false;f.show({message:"неверно заполнены поля формы!"})}return g};var e=function(j,i){if(j){var g=j.hasOwnProperty("ui")?j:d.create(j).instance;var k={tmpl:function(m){var l=this.owner;this.index=0;this.key=l.value.toLowerCase()||"null";if(l.pannel){var o=d.xml(tmpl(this.opt.tmpl,{data:m})).firstChild;if(o){l.pannel.innerHTML=o.innerHTML}}else{l.ui.parent.instance.insertAdjacentHTML("beforeend",tmpl(this.opt.tmpl,{data:m}));l.ui.parent.css().add("dropdown");l.pannel=l.ui.parent.el(".dropdown-menu.list")}l.ui.parent.els(".dropdown-menu.list li",function(n){n.ui.on("mousedown",function(p){l.value=this.innerHTML;if(l.typeahead.opt.key){l.typeahead.opt.key.value=this.ui.attr("value")}return false})})},xhr:function(){var l=this.owner,n={};n[l.name]=l.value;var m=l.value?l.value.toLowerCase():"null";if(!this.cache.hasOwnProperty(m)||m=="null"){l.status="spinner";xhr.request({url:location.update(l.ui.attr("url"),n),rs:{Hash:acl.user.hash}}).result(function(q){if([200,206].indexOf(this.status)<0){f.show({error:"ОШИБКА",message:this.status+": "+this.statusText})}else{try{var o=JSON.parse(this.responseText);if(o.result=="error"){f.show(o)}else{l.typeahead.cache[m]=o.data;l.typeahead.show(o.data)}}catch(p){f.show({message:"сервер вернул не коректные данные"})}}l.status="none";return this})}else{l.typeahead.show(this.cache[m])}},show:function(m){var l=this.owner;if(l===c.document.activeElement){if(Object.keys(m).length){this.tmpl(m);return fadeIn(l.pannel)}else{if(l.pannel){l.pannel.innerHTML=null;fadeOut(l.pannel)}}}return false},onKeydown:function(q){var o=(q.charCode&&q.charCode>0)?q.charCode:q.keyCode;var p=this.typeahead,n=p.cache[p.key],m=Object.keys(n||{}).length-1,r=0;switch(o){case 38:for(var l in n){if(r==p.index){this.value=n[l];if(p.opt.key){p.opt.key.value=l}this.selectionStart=this.selectionEnd=this.value.length;if(p.index>0){p.index--}else{p.index=m}q.preventDefault();q.stopPropagation();return false}r++}return false;case 40:for(var l in n){if(r==p.index){this.value=n[l];if(p.opt.key){p.opt.key.value=l}this.selectionStart=this.selectionEnd=this.value.length;if(p.index<m){p.index++}else{p.index=0}q.preventDefault();q.stopPropagation();return false}r++}return false;case 13:this.status="none";fadeOut(this.pannel);q.preventDefault();return q.stopPropagation();default:return false}},onChange:function(o){var m=this.typeahead;if(m.opt.key){m.opt.key.value="";if(this.value&&m.cache.hasOwnProperty(this.value.toLowerCase())){var n=this.typeahead.cache[this.value.toLowerCase()];for(var l in n){if(n[l].toLowerCase()===this.value.toLowerCase()){m.opt.key.value=l}}}return m.opt.key.value}return false},onFocus:function(l){this.typeahead.xhr();return false},onInput:function(l){this.typeahead.xhr();return false},onBlur:function(l){fadeOut(this.pannel);return false}};k.index=0;k.key=null;k.cache={};k.opt={master:[],slave:[],tmpl:"typeahead-tmpl"};g.typeahead=k;k.opt=Object.assign(k.opt,i);g.typeahead.owner=j;b(g.ui).on("focus",k.onFocus).ui.on("input",k.onInput).ui.on("blur",k.onBlur).ui.on("keydown",k.onKeydown).ui.on("change",k.onChange);if(!g.ui.attr("tabindex")){g.ui.attr("tabindex","0")}return g}};c.typeahead=e;var b=function(j){if(j&&!j.instance.hasOwnProperty("status")){var i=j.parent;j.instance.chk=i.el("span").ui;Object.defineProperty(j.instance,"status",{set:function g(k){i.css.add("has-feedback").del("has-error").del("has-warning").del("has-success");if(this.chk){this.chk.css.del("glyphicon-ok").del("glyphicon-warning-sign").del("glyphicon-remove").del("spinner")}switch(k){case"error":this._status="error";if(this.chk){this.chk.css.add("glyphicon-remove")}i.css.add("has-error");break;case"warning":this._status="warning";if(this.chk){this.chk.css.add("glyphicon-warning-sign")}i.css.add("has-warning");break;case"success":this._status="success";if(this.chk){this.chk.css.add("glyphicon-ok")}i.css.add("has-success");break;case"spinner":this._status="spinner";if(this.chk){this.chk.css.add("spinner")}break;case"none":default:this._status="none"}},get:function g(){return this._status}})}return j};c.inputer=b;var a=function(g,j){var i=b(g);if(i.instance.tagName==="INPUT"){if(j){i.instance.maxLength=i.attr("placeholder",j||"").attr("placeholder").length}if(!i.attr("tabindex")){i.attr("tabindex","0")}if(i&&!i.instance.hasOwnProperty("insertDigit")){i.instance.insertDigit=function(p,n){if(n){var r=this.value.indexOf(n);var o=/\d/.test(p)?1:0;var k=this.ui.attr("placeholder").substr(r,n.length).indexOf("_");if(k>0){r+=k}this.value=this.value.substr(0,r)+(/\d/.test(p)?p:"")+this.ui.attr("placeholder").substr(r+o,n.length-o)+this.value.substr(r+n.length,this.value.length);this.selectionStart=this.e1=this.selectionEnd=this.s1=r+1}else{if(/\d/.test(p)&&(this.value||this.ui.attr("placeholder")).indexOf("_")>-1){var q=this.value||this.ui.attr("placeholder");var r=(q).indexOf("_");var m=q.match(/\d/)?(q.indexOf(q.match(/\d/))):-1;if(r<=this.selectionStart||m<0||m>r){this.value=(this.value||this.ui.attr("placeholder")).replace("_",p);r=(this.value||this.ui.attr("placeholder")).indexOf("_");this.e1=this.selectionEnd=this.selectionStart=this.s1=r>-1?r:this.value.length}else{if(r>this.selectionStart){this.s1=r=this.selectionStart;var q=p+(this.value.substr(r,this.value.length).match(/\d+/g)||[]).join("")+"_";for(var l=0;l<q.length-1;l++){r=this.value.indexOf(q.charAt(l+1),r);if(r>-1){this.value=this.value.substr(0,r)+q.charAt(l)+this.value.substr(r+1,this.value.length)}}this.selectionStart=this.e1=this.selectionEnd=++this.s1}}}}return this.selectionStart};i.instance.init=function(k){var m=this.value;var n=0;if(m){this.value=this.ui.attr("placeholder");n=this.value.indexOf("_");for(var l in m){if(/\d/.test(m[l])){this.value=this.value.replace("_",m[l]);n=this.value.indexOf("_")}}}else{if(!k){this.value=this.ui.attr("placeholder")}n=this.ui.attr("placeholder").indexOf("_")}if(k){this.value=this.value.replace(/\_/g,"")}return this.e1=this.selectionEnd=this.selectionStart=this.s1=(n>-1?n:this.value.length)}}i.instance.init(true);i.on("keydown",function(o){if(this.ui.attr("placeholder").length&&!this.value){this.value=this.ui.attr("placeholder");this.e1=this.selectionEnd=this.selectionStart=this.s1=0}var m=window.getSelection().toString();var r=(o.charCode&&o.charCode>0)?o.charCode:o.keyCode;var q=((r>=96&&r<=105))?(r-96).toString():String.fromCharCode(r);switch(r){case 8:if(m){var p=this.value.indexOf(m);this.value=this.value.substr(0,p)+this.ui.attr("placeholder").substr(p,m.length)+this.value.substr(p+m.length,this.value.length);var l=this.ui.attr("placeholder").substr(p,m.length).indexOf("_");if(l>0){p+=l}this.selectionStart=this.e1=this.selectionEnd=this.s1=p}else{this.e1=this.s1=--this.selectionStart;--this.selectionEnd;while((this.s1>=0)&&!/\d/.test(this.value.charAt(this.s1))){this.s1=--this.selectionStart;--this.selectionEnd}if(this.s1>=0&&/\d/.test(this.value.charAt(this.s1))){this.value=this.value.substr(0,this.s1)+"_"+this.value.substr((this.s1+1),this.value.length)}else{this.s1=this.e1+1}this.selectionStart=this.selectionEnd=this.s1}break;case 9:var k=false;var s=o.shiftKey?-1:1;var n=parseInt(this.ui.attr("tabindex"));if(n>0){while(k=d.el('[tabindex="'+n+'"]')){if(k.ui.attr("disabled")){n+=s}else{k.focus();break}}}if(n<=1&&s<0){return o.preventDefault()}o.stopPropagation();return false;case 37:this.s1=--this.selectionStart;this.e1=--this.selectionEnd;break;case 39:this.s1=++this.selectionStart;break;default:this.insertDigit(q,m)}o.preventDefault();o.stopPropagation();return/d/.test(q)},false).ui.on("focus",function(k){this.init(false);k.preventDefault();k.stopPropagation();return false},false).ui.on("blur",function(k){if(this.value.match(/[\d]+/g)){this.value=this.value.replace(/\_/g,"")}else{this.value=""}k.preventDefault();k.stopPropagation();return false},false).ui.on("paste",function(m){var n=m.clipboardData.getData("Text").match(/\d+/g)?m.clipboardData.getData("Text").match(/\d+/g).join(""):"";var l=window.getSelection().toString();for(var k in n){this.insertDigit(n[k],l)}m.preventDefault();m.stopPropagation();return false},false)}return i};c.maskedigits=a}(window,window.ui));